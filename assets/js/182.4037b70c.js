(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{812:function(t,a,s){"use strict";s.r(a);var e=s(18),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Chrome 51 开始，浏览器的 cookie 新增加了Samesite属性，用来防止 CSRF 攻击和用户追踪。")]),t._v(" "),s("h2",{attrs:{id:"一、相关概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、相关概念"}},[t._v("#")]),t._v(" 一、相关概念")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("第一方cookie：第一方 cookie 指的是由网络用户访问的域，创建的 cookie。")])]),t._v(" "),s("li",[s("p",[t._v("第三方cookie：第三方 cookie 是建立在别的域名不是你访问的域名（地址栏中的网址），比如：广告网络商就是最常见的第三方 cookies 的来源，他们用它们在多个网站上追踪用户的行为，当然这些活动可以用来调整广告。此外图像JavaScript 和 firame 通常也会导致第三方cookies 的生成。")])])]),t._v(" "),s("p",[s("strong",[t._v("CSRF 攻击是什么？")])]),t._v(" "),s("ul",[s("li",[t._v("Cookie 往往用来存储用户的身份信息，恶意网站可以设法伪造带有正确 Cookie 的 HTTP 请求，这就是\nCSRF 攻击。")]),t._v(" "),s("li",[t._v("举例来说，用户登陆了银行网站your-bank.com，银行服务器发来了一个 Cookie。")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Set-Cookie: id = a3fWa;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("用户后来又访问了恶意网站 malicious.com上面有一个表单。")])]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("your-bank.com/transfer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("method")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("POST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("   \n    ... \n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[t._v("用户一旦被诱骗发送这个表单，银行网站就会收到带有正确 Cookie 的清求。为了防止这种攻击，表单一般都带有一个随机 token，告诉服务器这是真实请求。")])]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("your-bank.com/transfer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("method")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("POST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("    \n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dad3weg34"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("   \n    ... \n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[t._v("这种第三方网站引导发出的 cookie，就称为第三方cookie。它除了用于 CSRF 攻击，还可以用于用户追踪。\n比如，Facebook 在第三方网站插入一张看不见的图片。")])]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("facebook.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token special-attr"}},[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token value css language-css"}},[s("span",{pre:!0,attrs:{class:"token property"}},[t._v("visibility")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("hidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("浏览器加载上面代码时，就会向 Facebook 发出带有cookie 的请求，从而 Facebook 就会知道你是\n谁，访问了什么网站。")])]),t._v(" "),s("h2",{attrs:{id:"二、samesite属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、samesite属性"}},[t._v("#")]),t._v(" 二、Samesite属性")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Samesite 是HTTP响应头 set-cookie 的属性之一。")])]),t._v(" "),s("li",[s("p",[t._v("用来限制第三方 cookie ，从而减少安全风险。")])])]),t._v(" "),s("p",[s("strong",[t._v("它可以设置三个值：")])]),t._v(" "),s("p",[s("strong",[t._v("1、Strict")])]),t._v(" "),s("ul",[s("li",[t._v("严格模式，表示这个 cookie 在任何情况下都不可能作为第三方 cookie。即当前URL与请求目标一致，才对带上Cookie.")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Set-Cookie:CookieName = CookieValue; SameSite = Strict;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("这个规则过于严格，可能造成非常不好的用户体验。比如，当前网页有个GitHub 链接，用户点击\n跳转就不会带有 GitHub 的 Cookie，跳转过去总是末登陆状态。")])]),t._v(" "),s("p",[s("strong",[t._v("2、Lax")])]),t._v(" "),s("ul",[s("li",[t._v("宽松模式，也是目前浏览器中的默认值。大多数情况也是不发送第三方cookie， 但是导航到目标网址的 Get 请求除外。")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Set-Cookie:CookieName = CookieValue; SameSite = Lax;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("导航到目标网址的 GET 请求，只包括三种情况：链接，预加载请求，GET 表单。详见下表。")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("请求类型")]),t._v(" "),s("th",[t._v("示例")]),t._v(" "),s("th",[t._v("正常情况")]),t._v(" "),s("th",[t._v("Lax")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("链接")]),t._v(" "),s("td",[s("code",[t._v('<a href="..."></a>')])]),t._v(" "),s("td",[t._v("发送 Cookie")]),t._v(" "),s("td",[t._v("发送 Cookie")])]),t._v(" "),s("tr",[s("td",[t._v("预加载")]),t._v(" "),s("td",[s("code",[t._v('<link rel="prerender" href="..."/>')])]),t._v(" "),s("td",[t._v("发送 Cookie")]),t._v(" "),s("td",[t._v("发送 Cookie")])]),t._v(" "),s("tr",[s("td",[t._v("GET 表单")]),t._v(" "),s("td",[s("code",[t._v('<form method="GET" action="...">')])]),t._v(" "),s("td",[t._v("发送 Cookie")]),t._v(" "),s("td",[t._v("发送 Cookie")])]),t._v(" "),s("tr",[s("td",[t._v("POST 表单")]),t._v(" "),s("td",[s("code",[t._v('<form method="POST" action="...">')])]),t._v(" "),s("td",[t._v("发送 Cookie")]),t._v(" "),s("td",[t._v("不发送")])]),t._v(" "),s("tr",[s("td",[t._v("iframe")]),t._v(" "),s("td",[s("code",[t._v('<iframe src="..."></iframe>')])]),t._v(" "),s("td",[t._v("发送 Cookie")]),t._v(" "),s("td",[t._v("不发送")])]),t._v(" "),s("tr",[s("td",[t._v("AJAX")]),t._v(" "),s("td",[s("code",[t._v('$.get("...")')])]),t._v(" "),s("td",[t._v("发送 Cookie")]),t._v(" "),s("td",[t._v("不发送")])]),t._v(" "),s("tr",[s("td",[t._v("Image")]),t._v(" "),s("td",[s("code",[t._v('<img src="...">')])]),t._v(" "),s("td",[t._v("发送 Cookie")]),t._v(" "),s("td",[t._v("不发送")])])])]),t._v(" "),s("ul",[s("li",[t._v("使用这种方法的缺点是，因为它不支持子域，所以子域没有办法与主域共享登录信息每次转入子域的网站，都需要重新登录。")]),t._v(" "),s("li",[t._v("还有一个问题就是它的兼容性不够好。")])]),t._v(" "),s("p",[s("strong",[t._v("3、None")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("cookie将在所有上下文中发送，即允许跨域发送。")])]),t._v(" "),s("li",[s("p",[t._v("必须同时设置"),s("code",[t._v("Secure")]),t._v("属性（Cookie 只能通过 HTTPS 协议发送），否则无效。")])])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Set-Cookie:flavor = choco; SameSite = None; Secure\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"三、如何使用samesite-cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、如何使用samesite-cookie"}},[t._v("#")]),t._v(" "),s("strong",[t._v("三、如何使用Samesite Cookie")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("如果Samesite Cookie被设置为strict")]),t._v(" "),s("ul",[s("li",[t._v("浏览器在任何跨域请求中都不会携带Cookie，新标签重新打开也不携带，所以说CSRF攻击基本没有机会。")]),t._v(" "),s("li",[t._v("但是跳转子域名或者是新标签重新打开刚登陆的网站，之前的Cookie都不会存在。")]),t._v(" "),s("li",[t._v("尤其是有登录的网站，那么我们新打开一个标签进入，或者跳转到子域名的网站，都需要重新登录。")]),t._v(" "),s("li",[t._v("对于用户来讲，可能体验不会很好。")])])]),t._v(" "),s("li",[s("p",[t._v("如果SamesiteCookie被设置为Lax")]),t._v(" "),s("ul",[s("li",[t._v("那么其他网站通过页面跳转过来的时候可以使用Cookie，可以保障外域连接打开页面时用户的登录状态。")]),t._v(" "),s("li",[t._v("但相应的，其安全性也比较低。")])])]),t._v(" "),s("li",[s("p",[t._v("另外一个问题是Samesite的兼容性不是很好，现阶段除了从新版Chrome和Firefox支持以外，Safari以及iOS Safari都还不支持，现阶段看来暂时还不能普及。")])]),t._v(" "),s("li",[s("p",[t._v("Samesite Cookie目前有一个致命的缺陷：不支持子域。例如，种在topic.a.com下的Cookie，并不能使用a.com下种植的Samesite Cookie。这就导致了当我们网站有多个子域名时，不能使用Samesite Cookie在主域名存储用户登录信息。每个子域名都需要用户重新登录一次。")])]),t._v(" "),s("li",[s("p",[t._v("总之，SamesiteCookie是一个可能替代同源验证的方案，但目前还并不成熟，其应用场景有待观望。")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);