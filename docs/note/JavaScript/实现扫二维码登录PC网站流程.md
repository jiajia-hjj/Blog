---
title: 实现扫二维码登录PC网站流程
tags:
  - JavaScript
categories:
  - JavaScript
---



> 需求：怎么实现一个扫描二维码登录 PC 网站的需求？

## 一、二维码登录本质

二维码登录本质上也是一种登录认证方式。既是登录认证，要做的也就两件事情：

+ 告诉系统我是谁

+ 向系统证明我是谁

## 三、扫描二维码登录的一般步骤

+ 扫码前，手机端应用是已登录状态， PC 端显示一个二维码，等待扫描
+ 手机端打开应用，扫描 PC 端的二维码，扫描后，会提示＂已扫描，请在手机端点击确认＂
+ 用户在手机端点击确认，确认后 PC 端登录就成功了

## 四、具体流程

### 4.1.生成二维码
+ PC 端向服务端发起请求，告诉服务端，我要生成用户登录的二维码，并且把 PC 端设备信户传递给服务端
+ 服务端收到请求后，它生成二维码 ID ，并将二维码 ID 与 PC 端设备信息进行绑定

+ 然后把二维码 ID 返回给 PC 端

+ PC 端收到二维码 ID 后，生成二维码（二维码中肯定包含了 ID )

+ 为了及时知道二维码的状态，客户端在展现二维码后， PC 端不断的==轮询服务端==，比如每隔一秒就轮询一次，请求服务端告诉当前二维码的状态及相关信息，或者直接使用 ==websocket== ，等待在服务端完成登录后进行通知

### 4.2.扫描二维码

+ 用户用手机去扫描 PC 端的二维码，通过二维码内容取到其中的二维码 ID 
+ 再调用服务端 API 将移动端的身份信息与二维码 ID 一起发送给服务端
+ 服务端接收到后，它可以将身份信息与二维码 ID 进行绑定，生成临时 token 。然后返回给手机端。
+ 因为 PC 端一直在轮询二维码状态，所以这时候二维码状态发生了改变，它就可以在界面上把二维码状态更新为＂已扫描＂

### 4.3.状态确认
+ 手机端在接收到临时 token 后会弹出确认登录界面，用户点击确认时，手机端携带临时 token 用来调用服务端的接口，告诉服务端，我已经确认

+ 服务端收到确认后，根据二维码 ID 绑定的设备信息与账号信息，生成用户 PC 端登录的 token 

+ 这时候 PC 端的轮询接口，它就可以得知二维码的状态已经变成了＂已确认＂。并且从服务端可以获取到用户登录的 token 

+ 到这里，登录就成功了，后端 PC 端就可以用 token 去访问服务端的资源了

  